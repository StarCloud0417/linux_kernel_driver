# 03 - GPIO Output Driver (LED Control) ğŸ’¡

é€™å ‚èª²æˆ‘å€‘é€²å…¥å¯¦æˆ°ï¼šæ§åˆ¶ç¡¬é«”ã€‚
æˆ‘å€‘å°‡å¯«ä¸€å€‹é©…å‹•ç¨‹å¼ä¾†æ§åˆ¶ Raspberry Pi 5 çš„ GPIO è…³ä½ï¼Œå¯¦ç¾é»ç‡ˆåŠŸèƒ½ã€‚

## Raspberry Pi 5 ç‰¹åˆ¥æ³¨æ„äº‹é … (RP1 Chip) âš ï¸

Raspberry Pi 5 ä½¿ç”¨äº†å…¨æ–°çš„ I/O æ¶æ§‹ (RP1 æ™¶ç‰‡)ï¼Œé€™å°è‡´ GPIO çš„ç·¨è™Ÿèˆ‡èˆŠç‰ˆ (Pi 3/4) å®Œå…¨ä¸åŒã€‚
- åœ¨ Pi 3/4 ä¸Šï¼ŒGPIO 17 å°±æ˜¯ç³»çµ±ç·¨è™Ÿ `17`ã€‚
- åœ¨ Pi 5 ä¸Šï¼ŒGPIO çš„èµ·å§‹ç·¨è™Ÿæ˜¯å‹•æ…‹çš„ (ä¾‹å¦‚ `571` æˆ– `569`)ã€‚

**å¦‚ä½•æ‰¾åˆ°æ­£ç¢ºçš„ç·¨è™Ÿï¼Ÿ**
åŸ·è¡Œ `sudo cat /sys/kernel/debug/gpio`ï¼Œå°‹æ‰¾ `pinctrl-rp1` å€æ®µã€‚
åœ¨æœ¬ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘ç™¼ç¾ **GPIO 17** å°æ‡‰åˆ°ç³»çµ±ç·¨è™Ÿ **586**ã€‚
å› æ­¤ç¨‹å¼ç¢¼ä¸­å®šç¾©ç‚º `#define LED_GPIO 586`ã€‚

*(è‹¥æ‚¨çš„ç³»çµ±ä¸åŒï¼Œè«‹å‹™å¿…å…ˆæŸ¥è©¢å†ä¿®æ”¹ç¨‹å¼ç¢¼)*

## å­¸ç¿’é‡é» (Key Concepts)

1.  **GPIO API**: å­¸ç¿’æ ¸å¿ƒæä¾›çš„ `gpio_request`, `gpio_direction_output`, `gpio_set_value` ç­‰å‡½æ•¸ã€‚
2.  **Resource Management**: è³‡æºï¼ˆå¦‚ GPIO Pinï¼‰æ˜¯æœ‰é™çš„ï¼Œå¿…é ˆå…ˆã€Œç”³è«‹ã€æ‰èƒ½ç”¨ï¼Œç”¨å®Œå¿…é ˆã€Œé‡‹æ”¾ã€(`gpio_free`)ã€‚
3.  **Hardware Control**: é€é `write` ç³»çµ±å‘¼å«ä¾†è§¸ç™¼ç¡¬é«”å‹•ä½œã€‚

## ç¡¬é«”æ¥ç·š (Hardware Wiring)

è«‹æº–å‚™ï¼š
- ä¸€é¡† LED
- ä¸€å€‹é›»é˜» (220Î© æˆ– 330Î©)
- éºµåŒ…æ¿èˆ‡æœé‚¦ç·š

æ¥ç·šæ–¹å¼ï¼š
- **LED æ­£æ¥µ (é•·è…³)** -> æ¥åˆ° **GPIO 17** (å¯¦é«” Pin 11)
- **LED è² æ¥µ (çŸ­è…³)** -> ä¸²è¯é›»é˜» -> æ¥åˆ° **GND** (å¯¦é«” Pin 9 æˆ– 14)

## å¦‚ä½•æ¸¬è©¦ (How to Test)

### 1. ç·¨è­¯èˆ‡è¼‰å…¥
```bash
make
sudo insmod gpio_driver.ko
```

### 2. å»ºç«‹è£ç½®ç¯€é»
å…ˆæŸ¥çœ‹ Major Numberï¼š
```bash
dmesg | tail
# å‡è¨­çœ‹åˆ°: Registered correctly with major number 244
```

å»ºç«‹ç¯€é»ï¼š
```bash
sudo mknod /dev/my_led c 244 0
sudo chmod 666 /dev/my_led
```

### 3. æ§åˆ¶ LED
ç¾åœ¨ï¼Œæ‚¨å¯ä»¥ç”¨æ–‡å­—ä¾†æ§åˆ¶ç‡ˆå…‰äº†ï¼

**é–‹ç‡ˆï¼š**
```bash
echo 1 > /dev/my_led
```

**é—œç‡ˆï¼š**
```bash
echo 0 > /dev/my_led
```

### 4. ç›£æ§ Log (æ–¹ä¾¿é™¤éŒ¯)
ä¸æƒ³ä¸€ç›´æ‰“ `dmesg`ï¼Ÿå¯ä»¥ä½¿ç”¨ `-w` (follow) æ¨¡å¼ï¼š
```bash
sudo dmesg -w
```
é€™æ¨£åªè¦é©…å‹•ç¨‹å¼ä¸€æœ‰å‹•ä½œï¼Œè¨Šæ¯å°±æœƒè‡ªå‹•è·³å‡ºä¾†ã€‚

### 5. æ¸…ç†
```bash
sudo rm /dev/my_led
sudo rmmod gpio_driver
```
